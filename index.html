<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mon Hub Full Lua Obfuscator</title>
  <style>
    /* Nền tối, font monospace */
    body {
      background-color: #121212;
      color: #e0e0e0;
      font-family: 'Courier New', Courier, monospace;
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
      user-select: text;
    }
    h1 {
      text-align: center;
      margin-bottom: 15px;
      color: #7FFF00;
      text-shadow: 0 0 6px #7FFF00;
    }
    textarea {
      width: 100%;
      height: 250px;
      background: #1e1e1e;
      border: 1px solid #444;
      border-radius: 6px;
      color: #cfcfcf;
      font-size: 14px;
      padding: 12px;
      resize: vertical;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }
    textarea:focus {
      border-color: #7FFF00;
      outline: none;
      background: #272727;
    }
    button {
      background-color: #3CAF00;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 12px 24px;
      font-size: 15px;
      margin: 10px 5px 20px 0;
      cursor: pointer;
      transition: background-color 0.25s ease;
      user-select: none;
    }
    button:hover {
      background-color: #60d600;
    }
    pre#output {
      background-color: #1e1e1e;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 16px;
      white-space: pre-wrap;
      word-break: break-word;
      max-height: 450px;
      overflow-y: auto;
      font-size: 14px;
      color: #9f9;
    }
    footer {
      text-align: center;
      margin-top: 30px;
      color: #555;
      font-size: 13px;
      user-select: none;
    }
  </style>
</head>
<body>
  <h1>Mon Hub Full Lua Obfuscator</h1>

  <textarea id="input" placeholder="Paste your Lua or LuaU code here..."></textarea>
  <br />
  <button onclick="obfuscate()">Obfuscate Code</button>
  <button onclick="copyOutput()">Copy Obfuscated Code</button>

  <h3>Obfuscated Output</h3>
  <pre id="output" readonly></pre>

  <footer>© Mon Hub Obfuscator — Client-side Lua obfuscation tool</footer>

<script>
  // Sinh tên biến ngẫu nhiên 6 ký tự chữ cái
  function randName() {
    const letters = "abcdefghijklmnopqrstuvwxyz";
    let name = "";
    for (let i = 0; i < 6; i++) {
      name += letters.charAt(Math.floor(Math.random() * letters.length));
    }
    return name;
  }

  // Trộn mảng (Fisher–Yates shuffle)
  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // Mã hóa chuỗi: "abc" -> string.char(97,98,99)
  function encodeStrings(src) {
    // Đổi từng chuỗi "..." thành string.char(...)
    return src.replace(/"(.*?)"/g, (_, str) => {
      // Chuẩn hóa UTF-8 thành mã char code
      const codes = Array.from(unescape(encodeURIComponent(str))).map(c => c.charCodeAt(0));
      return `string.char(${codes.join(",")})`;
    });
  }

  // Tạo danh sách biến để đổi tên, bỏ các từ khóa lua phổ biến
  function renameVars(src) {
    const keywords = new Set([
      "and", "break", "do", "else", "elseif", "end", "false", "for", "function",
      "goto", "if", "in", "local", "nil", "not", "or", "repeat", "return",
      "then", "true", "until", "while", "string", "char", "math", "table",
      "print", "error", "require"
    ]);

    // Tìm tất cả từ có dạng biến/ hàm
    const candidates = src.match(/\b[a-zA-Z_][a-zA-Z0-9_]*\b/g) || [];
    // Loại bỏ trùng, lọc keywords
    let unique = Array.from(new Set(candidates)).filter(v => !keywords.has(v));

    // Trộn để đổi tên ngẫu nhiên
    shuffleArray(unique);

    const mapNames = {};
    unique.forEach(v => {
      mapNames[v] = randName();
    });

    // Thay thế toàn bộ
    Object.entries(mapNames).forEach(([orig, obf]) => {
      // Thay cả những biến trong code, tránh đè biến từ khóa
      const re = new RegExp(`\\b${orig}\\b`, "g");
      src = src.replace(re, obf);
    });
    return src;
  }

  // Chèn mã rác opaque predicates kiểu if true then ... end
  function injectGarbage() {
    let garbages = "";
    for (let i = 0; i < 3; i++) {
      garbages += `if (${i + 100} == ${i + 100}) then local x${i} = 0 end\n`;
    }
    return garbages;
  }

  // Xóa comment -- và nén nhiều khoảng trắng
  function cleanCode(src) {
    // Xóa comment dòng
    src = src.replace(/--.*$/gm, "");
    // Nén khoảng trắng nhiều thành 1 space
    src = src.replace(/\s+/g, " ");
    // Xóa khoảng trắng đầu cuối
    return src.trim();
  }

  function obfuscate() {
    let src = document.getElementById("input").value;
    if (!src.trim()) {
      alert("Please paste your Lua code first!");
      return;
    }

    // 1. Encode strings
    src = encodeStrings(src);

    // 2. Rename vars/functions
    src = renameVars(src);

    // 3. Inject garbage code
    const garbage = injectGarbage();
    src = garbage + src;

    // 4. Add header + checksum + wrapper function
    const checksum = src.length;
    const header = `--[[
 M   M   OOO   N   N     H   H   U   U   B   B     OOO   B   B   FFFFF  U   U   SSSS   CCCC   AAAAA  TTTTT  OOO   RRRR  
 MM MM  O   O  NN  N     H   H   U   U   B   B    O   O  B   B   F      U   U  S      C      A   A    T   O   O  R   R 
 M M M  O   O  N N N     HHHHH   U   U   BBBBB    O   O  BBBBB   F      U   U  SSS    C      AAAAA    T   O   O  RRRR  
 M   M  O   O  N  NN     H   H   U   U   B   B    O   O  B   B   F      U   U     S   C      A   A    T   O   O  R  R  
 M   M   OOO   N   N     H   H   UUUUU   B   B     OOO   B   B   F       UUUU  SSSS    CCCC   A   A    T    OOO   R   R 
 This file was protect by Mon Hub Obfuscator
]]--

`;

    // Kiểm tra checksum để chống sửa code
    const wrapper = `${header}
if (#"${src}".match(".") ~= ${checksum}) then error("Tampered!") end

return (function()
${src}
end)()
`;

    // 5. Xóa comment dư thừa và nén
    const out = cleanCode(wrapper);

    document.getElementById("output").textContent = out;
  }

  function copyOutput() {
    const out = document.getElementById("output").textContent;
    if (!out) {
      alert("Nothing to copy!");
      return;
    }
    navigator.clipboard.writeText(out).then(() => {
      alert("Obfuscated code copied to clipboard!");
    }).catch(() => {
      alert("Copy failed. Please copy manually.");
    });
  }
</script>
</body>
</html>
